{"version":3,"sources":["config/layout.js","api/role.js","api/resource.js","views/role/ResourceTree.js","views/role/EditModal.js","views/role/Role.js","views/role/index.js"],"names":["queryFormItemLayout","labelCol","xs","span","sm","wrapperCol","queryFormColLayout","xxl","lg","modalFormItemLayout","getRoles","params","request","method","url","getTotalRoles","createRole","data","updateRole","deleteRole","id","getResources","getTotalResources","getDirs","createResource","updateResource","patchResource","deleteResource","TreeNode","MenuTree","props","onCheck","checkedKeys","halfCheckedKeys","keys","setState","onChange","onExpand","expandedKeys","autoExpandParent","renderTreeNodes","map","item","children","title","name","key","dataRef","value","state","resourceTree","this","checkable","selectable","length","Component","FormItem","Item","EditModal","create","visible","submitting","detail","open","handleOk","e","preventDefault","form","validateFields","err","values","a","res","resources","Number","success","onCreateSuccess","onEditSuccess","message","destroy","handleCancel","console","log","resetFields","getFieldDecorator","v","filter","type","width","onOk","onCancel","destroyOnClose","maskClosable","confirmLoading","label","rules","required","initialValue","placeholder","allowClear","autoComplete","description","ResourceTree","User","loading","deleting","list","total","page","size","sorter","query","Object","assign","queryTotalResources","listToTree","handleSearch","getFieldsValue","handleReset","handleTableChange","pagination","_","current","pageSize","field","order","sortProp","sortOrder","handlePaginationChange","handleDelete","record","confirm","content","centered","handleCreate","modalRef","handleCreateSuccess","handleEdit","modalRefFn","inst","modalProps","showTotal","showQuickJumper","showSizeChanger","onShowSizeChange","columns","align","dataIndex","render","text","formatDateTime","onClick","disabled","className","onSubmit","gutter","offset","htmlType","scroll","x","dataSource","rowKey","wrappedComponentRef"],"mappings":"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","file":"static/js/7.9fb4cbfb.chunk.js","sourcesContent":["export const queryFormItemLayout = {\r\n  labelCol: {\r\n    xs: { span: 24 },\r\n    sm: { span: 5 }\r\n  },\r\n  wrapperCol: {\r\n    xs: { span: 24 },\r\n    sm: { span: 19 }\r\n  }\r\n}\r\n\r\nexport const queryFormColLayout = {\r\n  xxl: 6,\r\n  lg: 8\r\n}\r\n\r\nexport const modalFormItemLayout = {\r\n  labelCol: { span: 6 },\r\n  wrapperCol: { span: 14 }\r\n}\r\n","import request from '@/utils/request'\r\n\r\nexport const getRoles = params => {\r\n  return request({\r\n    method: 'get',\r\n    url: '/role',\r\n    params\r\n  })\r\n}\r\n\r\nexport const getTotalRoles = () => {\r\n  return request({\r\n    method: 'get',\r\n    url: '/role/total'\r\n  })\r\n}\r\n\r\nexport const createRole = params => {\r\n  return request({\r\n    method: 'post',\r\n    url: '/role',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const updateRole = params => {\r\n  return request({\r\n    method: 'put',\r\n    url: '/role',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const deleteRole = params => {\r\n  return request({\r\n    method: 'delete',\r\n    url: `/role/${params.id}`\r\n  })\r\n}\r\n","import request from '@/utils/request'\r\n\r\nexport const getResources = params => {\r\n  return request({\r\n    method: 'get',\r\n    url: '/resource',\r\n    params\r\n  })\r\n}\r\n\r\nexport const getTotalResources = params => {\r\n  return request({\r\n    method: 'get',\r\n    url: '/resource/total',\r\n    params\r\n  })\r\n}\r\n\r\nexport const getDirs = params => {\r\n  return request({\r\n    method: 'get',\r\n    url: '/resource/dir',\r\n    params\r\n  })\r\n}\r\n\r\nexport const createResource = params => {\r\n  return request({\r\n    method: 'post',\r\n    url: '/resource',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const updateResource = params => {\r\n  return request({\r\n    method: 'put',\r\n    url: '/resource',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const patchResource = params => {\r\n  return request({\r\n    method: 'patch',\r\n    url: '/resource',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const deleteResource = params => {\r\n  return request({\r\n    method: 'delete',\r\n    url: `/resource/${params.id}`,\r\n    params\r\n  })\r\n}\r\n","import React, { Component } from 'react'\r\nimport { Tree } from 'antd'\r\n\r\nconst { TreeNode } = Tree\r\n\r\nclass MenuTree extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    const { checkedKeys, keys } = props.value\r\n    this.state = {\r\n      checkedKeys: checkedKeys || [], // 当前状态为 勾选 的节点 keys\r\n      keys: keys || [], // 需要传给后端的 keys，包含半勾选的 父节点\r\n      resourceTree: [],\r\n      expandedKeys: [],\r\n      autoExpandParent: true\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromProps(props, state) {\r\n    if (props.value.checkedKeys.length !== state.checkedKeys.length) {\r\n      const { checkedKeys } = props.value\r\n      return { checkedKeys }\r\n    }\r\n    if (props.value.keys.length !== state.keys.length) {\r\n      const { keys } = props.value\r\n      return { keys }\r\n    }\r\n    if (props.resourceTree.length !== state.resourceTree.length) {\r\n      // init expandedKeys by async resourceTree\r\n      const expandedKeys = props.resourceTree.map(item => item.id)\r\n      return { expandedKeys, resourceTree: props.resourceTree }\r\n    }\r\n    return null\r\n  }\r\n\r\n  onCheck = (checkedKeys, { halfCheckedKeys }) => {\r\n    // console.log('onCheck', checkedKeys)\r\n    // console.log('info ', halfCheckedKeys)\r\n    const keys = [...checkedKeys, ...halfCheckedKeys]\r\n    this.setState({\r\n      checkedKeys,\r\n      keys\r\n    })\r\n    this.props.onChange({ checkedKeys, keys })\r\n  }\r\n\r\n  onExpand = (expandedKeys) => {\r\n    this.setState({\r\n      expandedKeys,\r\n      autoExpandParent: true\r\n    })\r\n  }\r\n\r\n  renderTreeNodes = data => data.map(item => {\r\n    if (item.children) {\r\n      return (\r\n        <TreeNode title={item.name} key={item.id} dataRef={item}>\r\n          {this.renderTreeNodes(item.children)}\r\n        </TreeNode>\r\n      )\r\n    }\r\n    return <TreeNode key={item.id} title={item.name} />\r\n  })\r\n\r\n  render() {\r\n    const { resourceTree } = this.props\r\n    // // expandedKeys：默认全部展开\r\n    // const expandedKeys = resourceTree.map(item => item.name)\r\n    \r\n    return (\r\n      <Tree\r\n        autoExpandParent={this.state.autoExpandParent}\r\n        checkable\r\n        selectable={false}\r\n        onExpand={this.onExpand}\r\n        expandedKeys={this.state.expandedKeys}\r\n        onCheck={this.onCheck}\r\n        checkedKeys={this.state.checkedKeys}\r\n      >\r\n        {this.renderTreeNodes(resourceTree)}\r\n      </Tree>\r\n    )\r\n  }\r\n}\r\n\r\nexport default MenuTree\r\n","import React, { Component } from 'react'\r\nimport { Modal, Form, Input, message } from 'antd'\r\nimport { modalFormItemLayout } from '@/config/layout'\r\nimport { createRole, updateRole } from '@/api/role'\r\nimport ResourceTree from './ResourceTree'\r\n\r\nconst { Item: FormItem } = Form\r\n\r\n@Form.create()\r\nclass EditModal extends Component {\r\n  state = {\r\n    visible: false,\r\n    submitting: false,\r\n    detail: {}\r\n  }\r\n  open = (detail = {}) => {\r\n    const title = detail.id ? '编辑' : '添加'\r\n    const data = {\r\n      title,\r\n      visible: true\r\n    }\r\n    if (detail.id) {\r\n      data.detail = detail\r\n    }\r\n    this.setState(data)\r\n  }\r\n  handleOk = (e) => {\r\n    e.preventDefault()\r\n    this.props.form.validateFields(async (err, values) => {\r\n      try {\r\n        if (err) return\r\n        const { detail } = this.state\r\n        this.setState({\r\n          submitting: true\r\n        })\r\n        let res = {}\r\n        const resources = values.resources.keys.map(Number)\r\n        if (detail.id) {\r\n          res = await updateRole({\r\n            ...values,\r\n            id: detail.id,\r\n            resources\r\n          })\r\n        } else {\r\n          res = await createRole({\r\n            ...values,\r\n            resources\r\n          })\r\n        }\r\n        if (res.success) {\r\n          const {onCreateSuccess, onEditSuccess} = this.props\r\n          message.destroy()\r\n          message.success(detail.id ? '修改成功' : '添加成功')\r\n          this.handleCancel()\r\n          detail.id ? onEditSuccess() : onCreateSuccess()\r\n        }\r\n      } catch (err){\r\n        console.log(err)\r\n      } finally {\r\n        this.setState({\r\n          submitting: false\r\n        })\r\n      }\r\n    })\r\n  }\r\n  handleCancel = () => {\r\n    this.setState({\r\n      visible: false,\r\n      detail: {}\r\n    })\r\n    this.props.form.resetFields()\r\n  }\r\n  render() {\r\n    const { resourceTree = [], form } = this.props\r\n    const { visible, submitting, detail, title } = this.state\r\n    const { getFieldDecorator } = form\r\n    const resources = detail.resources || []\r\n    const keys = resources.map(v => v.id)\r\n    // exclude dir item\r\n    const checkedKeys = resources.filter(item => item.type === '2').map(v => v.id)\r\n    return (\r\n      <Modal\r\n        title={title}\r\n        width={600}\r\n        visible={visible}\r\n        onOk={this.handleOk}\r\n        onCancel={this.handleCancel}\r\n        destroyOnClose={false}\r\n        maskClosable={false}\r\n        confirmLoading={submitting}\r\n      >\r\n        <Form>\r\n          \r\n          <FormItem label=\"角色名\" {...modalFormItemLayout}>\r\n            {getFieldDecorator('name', {\r\n              rules: [{ required: true, message: '请输入角色名!' }],\r\n              initialValue: detail.name || ''\r\n            })(\r\n              <Input placeholder=\"请输入角色名\" allowClear autoComplete=\"off\" />\r\n            )}\r\n          </FormItem>\r\n          \r\n          <FormItem label=\"角色描述\" {...modalFormItemLayout}>\r\n            {getFieldDecorator('description', {\r\n              rules: [{ required: true, message: '请输入角色描述!' }],\r\n              initialValue: detail.description || ''\r\n            })(\r\n              <Input placeholder=\"请输入角色描述\" allowClear autoComplete=\"off\" />\r\n            )}\r\n          </FormItem>\r\n          \r\n          <FormItem label=\"可用权限\" {...modalFormItemLayout}>\r\n            {getFieldDecorator('resources', {\r\n              rules: [{ required: true, message: '请选择父级菜单!' }],\r\n              initialValue: {checkedKeys, keys}\r\n            })(\r\n              <ResourceTree resourceTree={resourceTree} />\r\n            )}\r\n          </FormItem>\r\n          \r\n        </Form>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n\r\nexport default EditModal\r\n","import React, { Component } from 'react'\r\nimport { Form, Row, Col, Input, Button, Table, Pagination, message, Modal } from 'antd'\r\nimport { queryFormItemLayout, queryFormColLayout } from '@/config/layout'\r\nimport { formatDateTime, listToTree } from '@/utils'\r\nimport { getRoles, deleteRole } from '@/api/role'\r\nimport { getTotalResources } from '@/api/resource'\r\nimport EditModal from './EditModal'\r\n\r\nconst { Item: FormItem } = Form\r\n\r\n@Form.create()\r\nclass User extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.modalRefFn = inst => this.modalRef = inst\r\n  }\r\n  state = {\r\n    loading: false,\r\n    deleting: false,\r\n    list: [],\r\n    total: 0,\r\n    page: 1,\r\n    size: 10,\r\n    resourceTree: []\r\n  }\r\n  form = {}\r\n  sorter = {}\r\n  componentDidMount() {\r\n    this.query()\r\n    this.queryTotalResources()\r\n  }\r\n  query = async () => {\r\n    try {\r\n      this.setState({\r\n        loading: true\r\n      })\r\n      const params = Object.assign({}, this.form, this.sorter, {\r\n        page: this.state.page,\r\n        size: this.state.size\r\n      })\r\n      const res = await getRoles(params)\r\n      if (res.success) {\r\n        this.setState({\r\n          list: res.data.list || [],\r\n          total: res.data.total || 0\r\n        })\r\n      }\r\n    } catch (err) {\r\n      console.log(err)\r\n    } finally {\r\n      this.setState({\r\n        loading: false\r\n      })\r\n    }\r\n  }\r\n  queryTotalResources = async () => {\r\n    try {\r\n      const res = await getTotalResources()\r\n      if (res.success) {\r\n        const list = res.data || []\r\n        const resourceTree = listToTree(list, null, 'code', 'parentCode')\r\n        this.setState({\r\n          resourceTree\r\n        })\r\n      }\r\n    } catch (err) {\r\n      console.log(err)\r\n    }\r\n  }\r\n  handleSearch = e => {\r\n    e.preventDefault()\r\n    const values = this.props.form.getFieldsValue()\r\n    this.form = values\r\n    this.query()\r\n  }\r\n  handleReset = () => {\r\n    this.props.form.resetFields()\r\n    this.form = {}\r\n    this.query()\r\n  }\r\n  handleTableChange = (pagination, _, sorter) => {\r\n    const { current, pageSize } = pagination\r\n    this.setState({\r\n      page: current || 1,\r\n      size: pageSize || 10\r\n    }, () => {\r\n      const params = {}\r\n      if (sorter.field && sorter.order) {\r\n        params.sortProp = sorter.field\r\n        params.sortOrder = sorter.order === 'ascend' ? 1 : -1\r\n      } else {\r\n        params.sortProp = null\r\n        params.sortOrder = null\r\n      }\r\n      this.sorter = params\r\n      this.query()\r\n    })\r\n  }\r\n  handlePaginationChange = (page, size) => {\r\n    this.setState({\r\n      page,\r\n      size\r\n    }, () => {\r\n      this.query()\r\n    })\r\n  }\r\n  handleDelete = (record) => {\r\n    Modal.confirm({\r\n      title: '温馨提示',\r\n      content: '确定要删除吗？',\r\n      centered: true,\r\n      onOk: () => {\r\n        this.setState({\r\n          deleting: true,\r\n          loading: true\r\n        }, async () => {\r\n          try {\r\n            const res = await deleteRole({\r\n              id: record.id\r\n            })\r\n            if (res.success) {\r\n              this.query()\r\n              message.destroy()\r\n              message.success('删除成功')\r\n            }\r\n          } catch (err) {\r\n            console.log(err)\r\n          } finally {\r\n            this.setState({\r\n              deleting: false,\r\n              loading: false\r\n            })\r\n          }\r\n        })\r\n      },\r\n      onCancel: () => {\r\n        // ...\r\n      }\r\n    })\r\n  }\r\n  handleCreate = () => {\r\n    this.modalRef.open()\r\n  }\r\n  handleCreateSuccess = () => {\r\n    this.setState({\r\n      page: 1,\r\n      size: 10\r\n    }, () => {\r\n      this.query()\r\n    })\r\n  }\r\n  handleEdit = (record) => {\r\n    this.modalRef.open(record)\r\n  }\r\n  \r\n  render() {\r\n    const { getFieldDecorator } = this.props.form\r\n    const { loading, list, total, page, size, resourceTree } = this.state\r\n    const modalProps = {\r\n      resourceTree,\r\n      onCreateSuccess: this.handleCreateSuccess,\r\n      onEditSuccess: () => this.query()\r\n    }\r\n    const pagination = {\r\n      total,\r\n      current: page,\r\n      pageSize: size,\r\n      showTotal: total => `共${total}条`,\r\n      showQuickJumper: true,\r\n      showSizeChanger: true,\r\n      onChange: this.handlePaginationChange,\r\n      onShowSizeChange: this.handlePaginationChange\r\n    }\r\n    const columns = [{\r\n      title: '角色名',\r\n      align: 'center',\r\n      dataIndex: 'name',\r\n      key: 'name'\r\n    }, {\r\n      title: '角色描述',\r\n      align: 'center',\r\n      dataIndex: 'description',\r\n      key: 'description'\r\n    }, {\r\n      title: '添加时间',\r\n      align: 'center',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      sorter: true,\r\n      // sortOrder: sortOrder,\r\n      render: (text) => <span>{text ? formatDateTime(text) : '-'}</span>\r\n    }, {\r\n      title: '修改时间',\r\n      align: 'center',\r\n      dataIndex: 'updatedAt',\r\n      key: 'updatedAt',\r\n      sorter: true,\r\n      // sortOrder: sortOrder,\r\n      render: (text) => <span>{text ? formatDateTime(text) : '-'}</span>\r\n    }, {\r\n      title: '操作',\r\n      align: 'center',\r\n      dataIndex: 'operation',\r\n      key: 'operation',\r\n      render: (_, record) => {\r\n        if (record.name === '超级管理员') {\r\n          return <span>-</span>\r\n        }\r\n        return (\r\n          <span>\r\n            <Button type=\"link\" onClick={() => this.handleEdit(record)}>编辑</Button>\r\n            <Button type=\"link\" disabled={this.state.deleting} onClick={() => this.handleDelete(record)}>删除</Button>\r\n          </span>\r\n        )\r\n      }\r\n    }]\r\n    return (\r\n      <div className=\"com-container\">\r\n        <Form onSubmit={this.handleSearch}>\r\n          <Row gutter={24}>\r\n\r\n            <Col {...queryFormColLayout}>\r\n              <FormItem label=\"角色名\" {...queryFormItemLayout}>\r\n                {getFieldDecorator('name', {\r\n                  initialValue: ''\r\n                })(\r\n                  <Input placeholder=\"请输入角色名\" allowClear autoComplete=\"off\" />\r\n                )}\r\n              </FormItem>\r\n            </Col>\r\n\r\n            <Col {...queryFormColLayout}>\r\n              <FormItem wrapperCol={{offset: 2}}>\r\n                <Button type=\"primary\" htmlType=\"submit\" disabled={loading} onSubmit={this.handleSearch}>查询</Button>\r\n                <Button onClick={this.handleReset} disabled={loading}>重置</Button>\r\n                <Button type=\"primary\" onClick={this.handleCreate}>添加</Button>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n\r\n        </Form>\r\n        <div className=\"table-container\">\r\n          <Table\r\n            scroll={{ x: 1376 }}\r\n            loading={loading}\r\n            dataSource={list}\r\n            columns={columns}\r\n            rowKey=\"id\"\r\n            pagination={false}\r\n            onChange={this.handleTableChange}\r\n          />\r\n        </div>\r\n        <div className=\"pagination-container\">\r\n          <Pagination {...pagination} />\r\n        </div>\r\n        <EditModal {...modalProps} wrappedComponentRef={this.modalRefFn} />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default User\r\n","export { default } from './Role'\r\n"],"sourceRoot":""}