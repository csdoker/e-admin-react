{"version":3,"sources":["config/layout.js","utils/index.js","api/role.js","api/resource.js","views/role/ResourceTree.js","views/role/EditModal.js","views/role/Role.js","views/role/index.js"],"names":["queryFormItemLayout","labelCol","xs","span","sm","wrapperCol","queryFormColLayout","xxl","lg","modalFormItemLayout","formatDateTime","date","moment","format","listToTree","list","id","key","parentKey","ret","filter","v","forEach","item","push","String","children","getRoles","params","axios","method","url","getTotalRoles","createRole","data","updateRole","deleteRole","getResources","getTotalResources","getDirs","createResource","updateResource","patchResource","deleteResource","TreeNode","MenuTree","props","onCheck","checkedKeys","halfCheckedKeys","keys","setState","onChange","onExpand","expandedKeys","autoExpandParent","renderTreeNodes","map","title","name","dataRef","value","state","resourceTree","this","checkable","selectable","length","Component","FormItem","Item","EditModal","create","visible","submitting","detail","open","handleOk","e","preventDefault","form","validateFields","err","values","a","res","resources","Number","success","onCreateSuccess","onEditSuccess","message","destroy","handleCancel","console","log","resetFields","getFieldDecorator","type","width","onOk","onCancel","destroyOnClose","maskClosable","confirmLoading","label","rules","required","initialValue","placeholder","allowClear","autoComplete","description","ResourceTree","User","loading","deleting","total","page","size","sorter","query","Object","assign","queryTotalResources","handleSearch","getFieldsValue","handleReset","handleTableChange","pagination","_","current","pageSize","field","order","sortProp","sortOrder","handlePaginationChange","handleDelete","record","confirm","content","centered","handleCreate","modalRef","handleCreateSuccess","handleEdit","modalRefFn","inst","modalProps","showTotal","showQuickJumper","showSizeChanger","onShowSizeChange","columns","align","dataIndex","render","text","onClick","disabled","className","onSubmit","gutter","offset","htmlType","scroll","x","dataSource","rowKey","wrappedComponentRef"],"mappings":"sHAAA,sGAAO,IAAMA,EAAsB,CACjCC,SAAU,CACRC,GAAI,CAAEC,KAAM,IACZC,GAAI,CAAED,KAAM,IAEdE,WAAY,CACVH,GAAI,CAAEC,KAAM,IACZC,GAAI,CAAED,KAAM,MAIHG,EAAqB,CAChCC,IAAK,EACLC,GAAI,GAGOC,EAAsB,CACjCR,SAAU,CAAEE,KAAM,GAClBE,WAAY,CAAEF,KAAM,M,0YChBf,IAGMO,EAAiB,SAACC,GAC7B,OAAOC,IAAOD,GAAME,OAAO,wBAGtB,SAASC,EAAWC,EAAMC,EAAIC,EAAKC,GACxC,IAAMC,EAAM,GASZ,OARaJ,EAAKK,QAAO,SAAAC,GAAC,OAAIA,EAAEH,KAAeF,KAC1CM,SAAQ,SAAAC,GACXJ,EAAIK,K,yVAAJ,IACKD,EADL,CAEEP,GAAIS,OAAOF,EAAKP,IAChBU,SAAUZ,EAAWC,EAAMQ,EAAKN,GAAMA,EAAKC,SAGxCC,I,iCCnBT,sLAEaQ,EAAW,SAAAC,GACtB,OAAOC,YAAM,CACXC,OAAQ,MACRC,IAAK,QACLH,YAISI,EAAgB,WAC3B,OAAOH,YAAM,CACXC,OAAQ,MACRC,IAAK,iBAIIE,EAAa,SAAAL,GACxB,OAAOC,YAAM,CACXC,OAAQ,OACRC,IAAK,QACLG,KAAMN,KAIGO,EAAa,SAAAP,GACxB,OAAOC,YAAM,CACXC,OAAQ,MACRC,IAAK,QACLG,KAAMN,KAIGQ,EAAa,SAAAR,GACxB,OAAOC,YAAM,CACXC,OAAQ,SACRC,IAAI,SAAD,OAAWH,EAAOZ,Q,iCCpCzB,0PAEaqB,EAAe,SAAAT,GAC1B,OAAOC,YAAM,CACXC,OAAQ,MACRC,IAAK,YACLH,YAISU,EAAoB,SAAAV,GAC/B,OAAOC,YAAM,CACXC,OAAQ,MACRC,IAAK,kBACLH,YAISW,EAAU,SAAAX,GACrB,OAAOC,YAAM,CACXC,OAAQ,MACRC,IAAK,gBACLH,YAISY,EAAiB,SAAAZ,GAC5B,OAAOC,YAAM,CACXC,OAAQ,OACRC,IAAK,YACLG,KAAMN,KAIGa,EAAiB,SAAAb,GAC5B,OAAOC,YAAM,CACXC,OAAQ,MACRC,IAAK,YACLG,KAAMN,KAIGc,EAAgB,SAAAd,GAC3B,OAAOC,YAAM,CACXC,OAAQ,QACRC,IAAK,YACLG,KAAMN,KAIGe,EAAiB,SAAAf,GAC5B,OAAOC,YAAM,CACXC,OAAQ,SACRC,IAAI,aAAD,OAAeH,EAAOZ,IACzBY,a,0aCnDIgB,E,IAAAA,SAkFOC,E,YA/Eb,WAAYC,GAAQ,IAAD,uBACjB,4CAAMA,KA4BRC,QAAU,SAACC,EAAD,GAAuC,IAAvBC,EAAsB,EAAtBA,gBAGlBC,EAAI,sBAAOF,GAAP,YAAuBC,IACjC,EAAKE,SAAS,CACZH,cACAE,SAEF,EAAKJ,MAAMM,SAAS,CAAEJ,cAAaE,UArClB,EAwCnBG,SAAW,SAACC,GACV,EAAKH,SAAS,CACZG,eACAC,kBAAkB,KA3CH,EA+CnBC,gBAAkB,SAAAtB,GAAI,OAAIA,EAAKuB,KAAI,SAAAlC,GACjC,OAAIA,EAAKG,SAEL,kBAACkB,EAAD,CAAUc,MAAOnC,EAAKoC,KAAM1C,IAAKM,EAAKP,GAAI4C,QAASrC,GAChD,EAAKiC,gBAAgBjC,EAAKG,WAI1B,kBAACkB,EAAD,CAAU3B,IAAKM,EAAKP,GAAI0C,MAAOnC,EAAKoC,WAvD1B,MAEab,EAAMe,MAA5Bb,EAFS,EAETA,YAAaE,EAFJ,EAEIA,KAFJ,OAGjB,EAAKY,MAAQ,CACXd,YAAaA,GAAe,GAC5BE,KAAMA,GAAQ,GACda,aAAc,GACdT,aAAc,GACdC,kBAAkB,GARH,E,sEA0DT,IACAQ,EAAkBC,KAAKlB,MAAvBiB,aAIR,OACE,uBACER,iBAAkBS,KAAKF,MAAMP,iBAC7BU,WAAS,EACTC,YAAY,EACZb,SAAUW,KAAKX,SACfC,aAAcU,KAAKF,MAAMR,aACzBP,QAASiB,KAAKjB,QACdC,YAAagB,KAAKF,MAAMd,aAEvBgB,KAAKR,gBAAgBO,O,gDA7DIjB,EAAOgB,GACrC,OAAIhB,EAAMe,MAAMb,YAAYmB,SAAWL,EAAMd,YAAYmB,OAEhD,CAAEnB,YADeF,EAAMe,MAAtBb,aAGNF,EAAMe,MAAMX,KAAKiB,SAAWL,EAAMZ,KAAKiB,OAElC,CAAEjB,KADQJ,EAAMe,MAAfX,MAGNJ,EAAMiB,aAAaI,SAAWL,EAAMC,aAAaI,OAG5C,CAAEb,aADYR,EAAMiB,aAAaN,KAAI,SAAAlC,GAAI,OAAIA,EAAKP,MAClC+C,aAAcjB,EAAMiB,cAEtC,S,GA3BYK,a,+jBCCTC,E,IAANC,KAwHOC,EAtHd,IAAKC,Q,8MAEJV,MAAQ,CACNW,SAAS,EACTC,YAAY,EACZC,OAAQ,I,EAEVC,KAAO,WAAkB,IAAjBD,EAAgB,uDAAP,GACTjB,EAAQiB,EAAO3D,GAAK,eAAO,eAC3BkB,EAAO,CACXwB,QACAe,SAAS,GAEPE,EAAO3D,KACTkB,EAAKyC,OAASA,GAEhB,EAAKxB,SAASjB,I,EAEhB2C,SAAW,SAACC,GACVA,EAAEC,iBACF,EAAKjC,MAAMkC,KAAKC,eAAhB,uCAA+B,WAAOC,EAAKC,GAAZ,yBAAAC,EAAA,mEAEvBF,EAFuB,oDAGnBP,EAAW,EAAKb,MAAhBa,OACR,EAAKxB,SAAS,CACZuB,YAAY,IAEVW,EAAM,GACJC,EAAYH,EAAOG,UAAUpC,KAAKO,IAAI8B,SACxCZ,EAAO3D,GATgB,kCAUbmB,YAAW,EAAD,GACjBgD,EADiB,CAEpBnE,GAAI2D,EAAO3D,GACXsE,eAbuB,QAUzBD,EAVyB,gDAgBbpD,YAAW,EAAD,GACjBkD,EADiB,CAEpBG,eAlBuB,QAgBzBD,EAhByB,eAqBvBA,EAAIG,UAAU,EACyB,EAAK1C,MAAvC2C,EADQ,EACRA,gBAAiBC,EADT,EACSA,cACxBC,EAAA,EAAQC,UACRD,EAAA,EAAQH,QAAQb,EAAO3D,GAAK,2BAAS,4BACrC,EAAK6E,eACLlB,EAAO3D,GAAK0E,IAAkBD,KA1BL,kDA6B3BK,QAAQC,IAAR,MA7B2B,yBA+B3B,EAAK5C,SAAS,CACZuB,YAAY,IAhCa,6EAA/B,oCAAAV,KAAA,iB,EAqCF6B,aAAe,WACb,EAAK1C,SAAS,CACZsB,SAAS,EACTE,OAAQ,KAEV,EAAK7B,MAAMkC,KAAKgB,e,wEAER,IAAD,EAC6BhC,KAAKlB,MADlC,IACCiB,oBADD,MACgB,GADhB,EACoBiB,EADpB,EACoBA,KADpB,EAEwChB,KAAKF,MAA5CW,EAFD,EAECA,QAASC,EAFV,EAEUA,WAAYC,EAFtB,EAEsBA,OAAQjB,EAF9B,EAE8BA,MAC7BuC,EAAsBjB,EAAtBiB,kBACFX,EAAYX,EAAOW,WAAa,GAChCpC,EAAOoC,EAAU7B,KAAI,SAAApC,GAAC,OAAIA,EAAEL,MAE5BgC,EAAcsC,EAAUlE,QAAO,SAAAG,GAAI,MAAkB,MAAdA,EAAK2E,QAAczC,KAAI,SAAApC,GAAC,OAAIA,EAAEL,MAC3E,OACE,uBACE0C,MAAOA,EACPyC,MAAO,IACP1B,QAASA,EACT2B,KAAMpC,KAAKa,SACXwB,SAAUrC,KAAK6B,aACfS,gBAAgB,EAChBC,cAAc,EACdC,eAAgB9B,GAEhB,2BAEE,kBAACL,EAAD,eAAUoC,MAAM,sBAAUhG,KACvBwF,EAAkB,OAAQ,CACzBS,MAAO,CAAC,CAAEC,UAAU,EAAMhB,QAAS,0CACnCiB,aAAcjC,EAAOhB,MAAQ,IAF9BsC,CAIC,uBAAOY,YAAY,uCAASC,YAAU,EAACC,aAAa,UAIxD,kBAAC1C,EAAD,eAAUoC,MAAM,4BAAWhG,KACxBwF,EAAkB,cAAe,CAChCS,MAAO,CAAC,CAAEC,UAAU,EAAMhB,QAAS,gDACnCiB,aAAcjC,EAAOqC,aAAe,IAFrCf,CAIC,uBAAOY,YAAY,6CAAUC,YAAU,EAACC,aAAa,UAIzD,kBAAC1C,EAAD,eAAUoC,MAAM,4BAAWhG,KACxBwF,EAAkB,YAAa,CAC9BS,MAAO,CAAC,CAAEC,UAAU,EAAMhB,QAAS,gDACnCiB,aAAc,CAAC5D,cAAaE,SAF7B+C,CAIC,kBAACgB,EAAD,CAAclD,aAAcA,Y,GA3GlBK,e,ECDVC,E,IAANC,KA6PO4C,EA3Pd,IAAK1C,Q,eAEJ,WAAY1B,GAAQ,IAAD,8BACjB,4CAAMA,KAGRgB,MAAQ,CACNqD,SAAS,EACTC,UAAU,EACVrG,KAAM,GACNsG,MAAO,EACPC,KAAM,EACNC,KAAM,GACNxD,aAAc,IAXG,EAanBiB,KAAO,GAbY,EAcnBwC,OAAS,GAdU,EAmBnBC,MAnBmB,sBAmBX,8BAAArC,EAAA,sEAEJ,EAAKjC,SAAS,CACZgE,SAAS,IAELvF,EAAS8F,OAAOC,OAAO,GAAI,EAAK3C,KAAM,EAAKwC,OAAQ,CACvDF,KAAM,EAAKxD,MAAMwD,KACjBC,KAAM,EAAKzD,MAAMyD,OAPf,SASc5F,YAASC,GATvB,QASEyD,EATF,QAUIG,SACN,EAAKrC,SAAS,CACZpC,KAAMsE,EAAInD,KAAKnB,MAAQ,GACvBsG,MAAOhC,EAAInD,KAAKmF,OAAS,IAbzB,gDAiBJvB,QAAQC,IAAR,MAjBI,yBAmBJ,EAAK5C,SAAS,CACZgE,SAAS,IApBP,4EAnBW,EA2CnBS,oBA3CmB,sBA2CG,gCAAAxC,EAAA,+EAEA9C,cAFA,QAEZ+C,EAFY,QAGVG,UACAzE,EAAOsE,EAAInD,MAAQ,GACnB6B,EAAejD,YAAWC,EAAM,KAAM,OAAQ,cACpD,EAAKoC,SAAS,CACZY,kBAPc,gDAWlB+B,QAAQC,IAAR,MAXkB,yDA3CH,EAyDnB8B,aAAe,SAAA/C,GACbA,EAAEC,iBACF,IAAMI,EAAS,EAAKrC,MAAMkC,KAAK8C,iBAC/B,EAAK9C,KAAOG,EACZ,EAAKsC,SA7DY,EA+DnBM,YAAc,WACZ,EAAKjF,MAAMkC,KAAKgB,cAChB,EAAKhB,KAAO,GACZ,EAAKyC,SAlEY,EAoEnBO,kBAAoB,SAACC,EAAYC,EAAGV,GAAY,IACtCW,EAAsBF,EAAtBE,QAASC,EAAaH,EAAbG,SACjB,EAAKjF,SAAS,CACZmE,KAAMa,GAAW,EACjBZ,KAAMa,GAAY,KACjB,WACD,IAAMxG,EAAS,GACX4F,EAAOa,OAASb,EAAOc,OACzB1G,EAAO2G,SAAWf,EAAOa,MACzBzG,EAAO4G,UAA6B,WAAjBhB,EAAOc,MAAqB,GAAK,IAEpD1G,EAAO2G,SAAW,KAClB3G,EAAO4G,UAAY,MAErB,EAAKhB,OAAS5F,EACd,EAAK6F,YAnFU,EAsFnBgB,uBAAyB,SAACnB,EAAMC,GAC9B,EAAKpE,SAAS,CACZmE,OACAC,SACC,WACD,EAAKE,YA3FU,EA8FnBiB,aAAe,SAACC,GACd,IAAMC,QAAQ,CACZlF,MAAO,2BACPmF,QAAS,6CACTC,UAAU,EACV1C,KAAM,WACJ,EAAKjD,SAAS,CACZiE,UAAU,EACVD,SAAS,GAFX,sBAGG,sBAAA/B,EAAA,+EAEmBhD,YAAW,CAC3BpB,GAAI2H,EAAO3H,KAHd,cAKSwE,UACN,EAAKiC,QACL9B,EAAA,EAAQC,UACRD,EAAA,EAAQH,QAAQ,6BARnB,gDAWCM,QAAQC,IAAR,MAXD,yBAaC,EAAK5C,SAAS,CACZiE,UAAU,EACVD,SAAS,IAfZ,8EAoBLd,SAAU,gBA3HK,EAgInB0C,aAAe,WACb,EAAKC,SAASpE,QAjIG,EAmInBqE,oBAAsB,WACpB,EAAK9F,SAAS,CACZmE,KAAM,EACNC,KAAM,KACL,WACD,EAAKE,YAxIU,EA2InByB,WAAa,SAACP,GACZ,EAAKK,SAASpE,KAAK+D,IA1InB,EAAKQ,WAAa,SAAAC,GAAI,OAAI,EAAKJ,SAAWI,GAFzB,E,iFAgBjBpF,KAAKyD,QACLzD,KAAK4D,wB,+BA8HG,IAAD,OACC3B,EAAsBjC,KAAKlB,MAAMkC,KAAjCiB,kBADD,EAEoDjC,KAAKF,MAAxDqD,EAFD,EAECA,QAASpG,EAFV,EAEUA,KAAMsG,EAFhB,EAEgBA,MAAOC,EAFvB,EAEuBA,KAAMC,EAF7B,EAE6BA,KAC9B8B,EAAa,CACjBtF,aAJK,EAEmCA,aAGxC0B,gBAAiBzB,KAAKiF,oBACtBvD,cAAe,kBAAM,EAAK+B,UAEtBQ,EAAa,CACjBZ,QACAc,QAASb,EACTc,SAAUb,EACV+B,UAAW,SAAAjC,GAAK,sBAAQA,EAAR,WAChBkC,iBAAiB,EACjBC,iBAAiB,EACjBpG,SAAUY,KAAKyE,uBACfgB,iBAAkBzF,KAAKyE,wBAEnBiB,EAAU,CAAC,CACfhG,MAAO,qBACPiG,MAAO,SACPC,UAAW,OACX3I,IAAK,QACJ,CACDyC,MAAO,2BACPiG,MAAO,SACPC,UAAW,cACX3I,IAAK,eACJ,CACDyC,MAAO,2BACPiG,MAAO,SACPC,UAAW,YACX3I,IAAK,YACLuG,QAAQ,EAERqC,OAAQ,SAACC,GAAD,OAAU,8BAAOA,EAAOpJ,YAAeoJ,GAAQ,OACtD,CACDpG,MAAO,2BACPiG,MAAO,SACPC,UAAW,YACX3I,IAAK,YACLuG,QAAQ,EAERqC,OAAQ,SAACC,GAAD,OAAU,8BAAOA,EAAOpJ,YAAeoJ,GAAQ,OACtD,CACDpG,MAAO,eACPiG,MAAO,SACPC,UAAW,YACX3I,IAAK,YACL4I,OAAQ,SAAC3B,EAAGS,GACV,MAAoB,mCAAhBA,EAAOhF,KACF,mCAGP,8BACE,uBAAQuC,KAAK,OAAO6D,QAAS,kBAAM,EAAKb,WAAWP,KAAnD,gBACA,uBAAQzC,KAAK,OAAO8D,SAAU,EAAKlG,MAAMsD,SAAU2C,QAAS,kBAAM,EAAKrB,aAAaC,KAApF,oBAKR,OACE,yBAAKsB,UAAU,iBACb,uBAAMC,SAAUlG,KAAK6D,cACnB,uBAAKsC,OAAQ,IAEX,sBAAS7J,IACP,kBAAC,EAAD,eAAUmG,MAAM,sBAAUzG,KACvBiG,EAAkB,OAAQ,CACzBW,aAAc,IADfX,CAGC,uBAAOY,YAAY,uCAASC,YAAU,EAACC,aAAa,WAK1D,sBAASzG,IACP,kBAAC,EAAD,CAAUD,WAAY,CAAC+J,OAAQ,IAC7B,uBAAQlE,KAAK,UAAUmE,SAAS,SAASL,SAAU7C,EAAS+C,SAAUlG,KAAK6D,cAA3E,gBACA,uBAAQkC,QAAS/F,KAAK+D,YAAaiC,SAAU7C,GAA7C,gBACA,uBAAQjB,KAAK,UAAU6D,QAAS/F,KAAK+E,cAArC,oBAMR,yBAAKkB,UAAU,mBACb,uBACEK,OAAQ,CAAEC,EAAG,MACbpD,QAASA,EACTqD,WAAYzJ,EACZ2I,QAASA,EACTe,OAAO,KACPxC,YAAY,EACZ7E,SAAUY,KAAKgE,qBAGnB,yBAAKiC,UAAU,wBACb,sBAAgBhC,IAElB,kBAAC,EAAD,iBAAeoB,EAAf,CAA2BqB,oBAAqB1G,KAAKmF,mB,GApP1C/E,e,ECXnB","file":"static/js/7.ae11a984.chunk.js","sourcesContent":["export const queryFormItemLayout = {\r\n  labelCol: {\r\n    xs: { span: 24 },\r\n    sm: { span: 5 }\r\n  },\r\n  wrapperCol: {\r\n    xs: { span: 24 },\r\n    sm: { span: 19 }\r\n  }\r\n}\r\n\r\nexport const queryFormColLayout = {\r\n  xxl: 6,\r\n  lg: 8\r\n}\r\n\r\nexport const modalFormItemLayout = {\r\n  labelCol: { span: 6 },\r\n  wrapperCol: { span: 14 }\r\n}","import moment from 'moment'\r\n\r\nexport const formatDate = (date) => {\r\n  return moment(date).format('YYYY-MM-DD')\r\n}\r\nexport const formatDateTime = (date) => {\r\n  return moment(date).format('YYYY-MM-DD HH:mm:ss')\r\n}\r\n\nexport function listToTree(list, id, key, parentKey) {\n  const ret = []\n  const temp = list.filter(v => v[parentKey] === id)\n  temp.forEach(item => {\n    ret.push({\n      ...item,\r\n      id: String(item.id),\n      children: listToTree(list, item[key], key, parentKey)\n    })\n  })\n  return ret\n}\r\n","import axios from '@/utils/axios'\r\n\r\nexport const getRoles = params => {\r\n  return axios({\r\n    method: 'get',\r\n    url: '/role',\r\n    params\r\n  })\r\n}\r\n\r\nexport const getTotalRoles = () => {\r\n  return axios({\r\n    method: 'get',\r\n    url: '/role/total'\r\n  })\r\n}\r\n\r\nexport const createRole = params => {\r\n  return axios({\r\n    method: 'post',\r\n    url: '/role',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const updateRole = params => {\r\n  return axios({\r\n    method: 'put',\r\n    url: '/role',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const deleteRole = params => {\r\n  return axios({\r\n    method: 'delete',\r\n    url: `/role/${params.id}`\r\n  })\r\n}\r\n","import axios from '@/utils/axios'\r\n\r\nexport const getResources = params => {\r\n  return axios({\r\n    method: 'get',\r\n    url: '/resource',\r\n    params\r\n  })\r\n}\r\n\r\nexport const getTotalResources = params => {\r\n  return axios({\r\n    method: 'get',\r\n    url: '/resource/total',\r\n    params\r\n  })\r\n}\r\n\r\nexport const getDirs = params => {\r\n  return axios({\r\n    method: 'get',\r\n    url: '/resource/dir',\r\n    params\r\n  })\r\n}\r\n\r\nexport const createResource = params => {\r\n  return axios({\r\n    method: 'post',\r\n    url: '/resource',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const updateResource = params => {\r\n  return axios({\r\n    method: 'put',\r\n    url: '/resource',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const patchResource = params => {\r\n  return axios({\r\n    method: 'patch',\r\n    url: '/resource',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const deleteResource = params => {\r\n  return axios({\r\n    method: 'delete',\r\n    url: `/resource/${params.id}`,\r\n    params\r\n  })\r\n}\r\n","import React, { Component } from 'react'\nimport { Tree } from 'antd'\n\nconst { TreeNode } = Tree\n\nclass MenuTree extends Component {\n  constructor(props) {\n    super(props)\n    const { checkedKeys, keys } = props.value\n    this.state = {\n      checkedKeys: checkedKeys || [], // 当前状态为 勾选 的节点 keys\n      keys: keys || [], // 需要传给后端的 keys，包含半勾选的 父节点\n      resourceTree: [],\n      expandedKeys: [],\n      autoExpandParent: true\n    }\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    if (props.value.checkedKeys.length !== state.checkedKeys.length) {\n      const { checkedKeys } = props.value\n      return { checkedKeys }\n    }\r\n    if (props.value.keys.length !== state.keys.length) {\r\n      const { keys } = props.value\r\n      return { keys }\r\n    }\r\n    if (props.resourceTree.length !== state.resourceTree.length) {\r\n      // init expandedKeys by async resourceTree\n      const expandedKeys = props.resourceTree.map(item => item.id)\r\n      return { expandedKeys, resourceTree: props.resourceTree }\r\n    }\n    return null\n  }\n\n  onCheck = (checkedKeys, { halfCheckedKeys }) => {\n    // console.log('onCheck', checkedKeys)\n    // console.log('info ', halfCheckedKeys)\n    const keys = [...checkedKeys, ...halfCheckedKeys]\n    this.setState({\n      checkedKeys,\n      keys\n    })\n    this.props.onChange({ checkedKeys, keys })\n  }\n\n  onExpand = (expandedKeys) => {\n    this.setState({\n      expandedKeys,\n      autoExpandParent: true\n    })\n  }\n\n  renderTreeNodes = data => data.map(item => {\n    if (item.children) {\n      return (\n        <TreeNode title={item.name} key={item.id} dataRef={item}>\n          {this.renderTreeNodes(item.children)}\n        </TreeNode>\n      )\n    }\n    return <TreeNode key={item.id} title={item.name} />\n  })\n\n  render() {\n    const { resourceTree }  = this.props\n    // // expandedKeys：默认全部展开\n    // const expandedKeys = resourceTree.map(item => item.name)\n    \n    return (\n      <Tree\n        autoExpandParent={this.state.autoExpandParent}\n        checkable\r\n        selectable={false}\n        onExpand={this.onExpand}\n        expandedKeys={this.state.expandedKeys}\n        onCheck={this.onCheck}\n        checkedKeys={this.state.checkedKeys}\n      >\n        {this.renderTreeNodes(resourceTree)}\n      </Tree>\n    )\n  }\n}\n\nexport default MenuTree","import React, { Component } from 'react'\r\nimport { Modal, Form, Input, message } from 'antd'\r\nimport { modalFormItemLayout } from '@/config/layout'\r\nimport { createRole, updateRole } from '@/api/role'\r\nimport ResourceTree from './ResourceTree'\r\n\r\nconst { Item: FormItem } = Form\r\n\r\n@Form.create()\r\nclass EditModal extends Component {\r\n  state = {\r\n    visible: false,\r\n    submitting: false,\r\n    detail: {}\r\n  }\r\n  open = (detail = {}) => {\r\n    const title = detail.id ? '编辑' : '添加'\r\n    const data = {\r\n      title,\r\n      visible: true\r\n    }\r\n    if (detail.id) {\r\n      data.detail = detail\r\n    }\r\n    this.setState(data)\r\n  }\r\n  handleOk = (e) => {\r\n    e.preventDefault()\r\n    this.props.form.validateFields(async (err, values) => {\r\n      try{\r\n        if (err) return\r\n        const { detail } = this.state\r\n        this.setState({\r\n          submitting: true\r\n        })\r\n        let res = {}\r\n        const resources = values.resources.keys.map(Number)\r\n        if (detail.id) {\r\n          res = await updateRole({\r\n            ...values,\r\n            id: detail.id,\r\n            resources\r\n          })\r\n        } else {\r\n          res = await createRole({\r\n            ...values,\r\n            resources\r\n          })\r\n        }\r\n        if (res.success) {\r\n          const {onCreateSuccess, onEditSuccess} = this.props\r\n          message.destroy()\r\n          message.success(detail.id ? '修改成功' : '添加成功')\r\n          this.handleCancel()\r\n          detail.id ? onEditSuccess() : onCreateSuccess()\r\n        }\r\n      } catch(err){\r\n        console.log(err)\r\n      } finally {\r\n        this.setState({\r\n          submitting: false\r\n        })\r\n      }\r\n    })\r\n  }\r\n  handleCancel = () => {\r\n    this.setState({\r\n      visible: false,\r\n      detail: {}\r\n    })\r\n    this.props.form.resetFields()\r\n  }\r\n  render() {\r\n    const { resourceTree = [], form } = this.props\r\n    const { visible, submitting, detail, title } = this.state\r\n    const { getFieldDecorator } = form\r\n    const resources = detail.resources || []\r\n    const keys = resources.map(v => v.id)\r\n    // exclude dir item\r\n    const checkedKeys = resources.filter(item => item.type === '2').map(v => v.id)\r\n    return (\r\n      <Modal\r\n        title={title}\r\n        width={600}\r\n        visible={visible}\r\n        onOk={this.handleOk}\r\n        onCancel={this.handleCancel}\r\n        destroyOnClose={false}\r\n        maskClosable={false}\r\n        confirmLoading={submitting}\r\n      >\r\n        <Form>\r\n          \r\n          <FormItem label=\"角色名\" {...modalFormItemLayout}>\r\n            {getFieldDecorator('name', {\r\n              rules: [{ required: true, message: '请输入角色名!' }],\r\n              initialValue: detail.name || ''\r\n            })(\r\n              <Input placeholder=\"请输入角色名\" allowClear autoComplete=\"off\" />\r\n            )}\r\n          </FormItem>\r\n          \r\n          <FormItem label=\"角色描述\" {...modalFormItemLayout}>\r\n            {getFieldDecorator('description', {\r\n              rules: [{ required: true, message: '请输入角色描述!' }],\r\n              initialValue: detail.description || ''\r\n            })(\r\n              <Input placeholder=\"请输入角色描述\" allowClear autoComplete=\"off\" />\r\n            )}\r\n          </FormItem>\r\n          \r\n          <FormItem label=\"可用权限\" {...modalFormItemLayout}>\r\n            {getFieldDecorator('resources', {\r\n              rules: [{ required: true, message: '请选择父级菜单!' }],\r\n              initialValue: {checkedKeys, keys}\r\n            })(\r\n              <ResourceTree resourceTree={resourceTree} />\r\n            )}\r\n          </FormItem>\r\n          \r\n        </Form>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n\r\nexport default EditModal\r\n","import React, { Component } from 'react'\r\nimport { Form, Row, Col, Input, Button, Table, Pagination, message, Modal } from 'antd'\r\nimport { queryFormItemLayout, queryFormColLayout } from '@/config/layout'\r\nimport { formatDateTime, listToTree } from '@/utils'\r\nimport { getRoles, deleteRole } from '@/api/role'\r\nimport { getTotalResources } from '@/api/resource'\r\nimport EditModal from './EditModal'\r\n\r\nconst { Item: FormItem } = Form\r\n\r\n@Form.create()\r\nclass User extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.modalRefFn = inst => this.modalRef = inst\r\n  }\r\n  state = {\r\n    loading: false,\r\n    deleting: false,\r\n    list: [],\r\n    total: 0,\r\n    page: 1,\r\n    size: 10,\r\n    resourceTree: []\r\n  }\r\n  form = {}\r\n  sorter = {}\r\n  componentDidMount() {\r\n    this.query()\r\n    this.queryTotalResources()\r\n  }\r\n  query = async () => {\r\n    try {\r\n      this.setState({\r\n        loading: true\r\n      })\r\n      const params = Object.assign({}, this.form, this.sorter, {\r\n        page: this.state.page,\r\n        size: this.state.size\r\n      })\r\n      const res = await getRoles(params)\r\n      if (res.success) {\r\n        this.setState({\r\n          list: res.data.list || [],\r\n          total: res.data.total || 0\r\n        })\r\n      }\r\n    } catch (err) {\r\n      console.log(err)\r\n    } finally {\r\n      this.setState({\r\n        loading: false\r\n      })\r\n    }\r\n  }\r\n  queryTotalResources = async () => {\r\n    try {\r\n      const res = await getTotalResources()\r\n      if (res.success) {\r\n        const list = res.data || []\r\n        const resourceTree = listToTree(list, null, 'code', 'parentCode')\r\n        this.setState({\r\n          resourceTree\r\n        })\r\n      }\r\n    } catch (err) {\r\n      console.log(err)\r\n    }\r\n  }\r\n  handleSearch = e => {\r\n    e.preventDefault()\r\n    const values = this.props.form.getFieldsValue()\r\n    this.form = values\r\n    this.query()\r\n  }\r\n  handleReset = () => {\r\n    this.props.form.resetFields()\r\n    this.form = {}\r\n    this.query()\r\n  }\r\n  handleTableChange = (pagination, _, sorter) => {\r\n    const { current, pageSize } = pagination\r\n    this.setState({\r\n      page: current || 1,\r\n      size: pageSize || 10\r\n    }, () => {\r\n      const params = {}\r\n      if (sorter.field && sorter.order) {\r\n        params.sortProp = sorter.field\r\n        params.sortOrder = sorter.order === 'ascend' ? 1 : -1\r\n      } else {\r\n        params.sortProp = null\r\n        params.sortOrder = null\r\n      }\r\n      this.sorter = params\r\n      this.query()\r\n    })\r\n  }\r\n  handlePaginationChange = (page, size) => {\r\n    this.setState({\r\n      page,\r\n      size\r\n    }, () => {\r\n      this.query()\r\n    })\r\n  }\r\n  handleDelete = (record) => {\r\n    Modal.confirm({\r\n      title: '温馨提示',\r\n      content: '确定要删除吗？',\r\n      centered: true,\r\n      onOk: () => {\r\n        this.setState({\r\n          deleting: true,\r\n          loading: true\r\n        }, async () => {\r\n          try {\r\n            const res = await deleteRole({\r\n              id: record.id\r\n            })\r\n            if (res.success) {\r\n              this.query()\r\n              message.destroy()\r\n              message.success('删除成功')\r\n            }\r\n          } catch (err) {\r\n            console.log(err)\r\n          } finally {\r\n            this.setState({\r\n              deleting: false,\r\n              loading: false\r\n            })\r\n          }\r\n        })\r\n      },\r\n      onCancel: () => {\r\n        // ...\r\n      }\r\n    })\r\n  }\r\n  handleCreate = () => {\r\n    this.modalRef.open()\r\n  }\r\n  handleCreateSuccess = () => {\r\n    this.setState({\r\n      page: 1,\r\n      size: 10\r\n    }, () => {\r\n      this.query()\r\n    })\r\n  }\r\n  handleEdit = (record) => {\r\n    this.modalRef.open(record)\r\n  }\r\n  \r\n  render() {\r\n    const { getFieldDecorator } = this.props.form\r\n    const { loading, list, total, page, size, resourceTree } = this.state\r\n    const modalProps = {\r\n      resourceTree,\r\n      onCreateSuccess: this.handleCreateSuccess,\r\n      onEditSuccess: () => this.query()\r\n    }\r\n    const pagination = {\r\n      total,\r\n      current: page,\r\n      pageSize: size,\r\n      showTotal: total => `共${total}条`,\r\n      showQuickJumper: true,\r\n      showSizeChanger: true,\r\n      onChange: this.handlePaginationChange,\r\n      onShowSizeChange: this.handlePaginationChange\r\n    }\r\n    const columns = [{\r\n      title: '角色名',\r\n      align: 'center',\r\n      dataIndex: 'name',\r\n      key: 'name'\r\n    }, {\r\n      title: '角色描述',\r\n      align: 'center',\r\n      dataIndex: 'description',\r\n      key: 'description'\r\n    }, {\r\n      title: '添加时间',\r\n      align: 'center',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      sorter: true,\r\n      // sortOrder: sortOrder,\r\n      render: (text) => <span>{text ? formatDateTime(text) : '-'}</span>\r\n    }, {\r\n      title: '修改时间',\r\n      align: 'center',\r\n      dataIndex: 'updatedAt',\r\n      key: 'updatedAt',\r\n      sorter: true,\r\n      // sortOrder: sortOrder,\r\n      render: (text) => <span>{text ? formatDateTime(text) : '-'}</span>\r\n    }, {\r\n      title: '操作',\r\n      align: 'center',\r\n      dataIndex: 'operation',\r\n      key: 'operation',\r\n      render: (_, record) => {\r\n        if (record.name === '超级管理员') {\r\n          return <span>-</span>\r\n        }\r\n        return (\r\n          <span>\r\n            <Button type=\"link\" onClick={() => this.handleEdit(record)}>编辑</Button>\r\n            <Button type=\"link\" disabled={this.state.deleting} onClick={() => this.handleDelete(record)}>删除</Button>\r\n          </span>\r\n        )\r\n      }\r\n    }]\r\n    return (\r\n      <div className=\"com-container\">\r\n        <Form onSubmit={this.handleSearch}>\r\n          <Row gutter={24}>\r\n\r\n            <Col {...queryFormColLayout}>\r\n              <FormItem label=\"角色名\" {...queryFormItemLayout}>\r\n                {getFieldDecorator('name', {\r\n                  initialValue: ''\r\n                })(\r\n                  <Input placeholder=\"请输入角色名\" allowClear autoComplete=\"off\" />\r\n                )}\r\n              </FormItem>\r\n            </Col>\r\n\r\n            <Col {...queryFormColLayout}>\r\n              <FormItem wrapperCol={{offset: 2}}>\r\n                <Button type=\"primary\" htmlType=\"submit\" disabled={loading} onSubmit={this.handleSearch}>查询</Button>\r\n                <Button onClick={this.handleReset} disabled={loading}>重置</Button>\r\n                <Button type=\"primary\" onClick={this.handleCreate}>添加</Button>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n\r\n        </Form>\r\n        <div className=\"table-container\">\r\n          <Table\r\n            scroll={{ x: 1376 }}\r\n            loading={loading}\r\n            dataSource={list}\r\n            columns={columns}\r\n            rowKey=\"id\"\r\n            pagination={false}\r\n            onChange={this.handleTableChange}\r\n          />\r\n        </div>\r\n        <div className=\"pagination-container\">\r\n          <Pagination {...pagination} />\r\n        </div>\r\n        <EditModal {...modalProps} wrappedComponentRef={this.modalRefFn} />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default User\r\n","export { default } from './Role'\r\n"],"sourceRoot":""}